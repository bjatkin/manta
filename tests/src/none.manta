// examples/none.manta
mod main

use (
    "fmt"
    "unsafe"
)

// TODO: replace with unsafe::ptr when modules are fully supported
type UnsafePtr struct {}

// TODO: replace with fmt::println when modules are fully supported
fn fmt_println_ptr(p *i32) {}
fn fmt_println(s str) {}

type MaybeAlloc enum {
    Ok(*i32)
    DidNotAlloc
    AllocFailed(UnsafePtr)
}

// maybe_alloc allocates memory for an i32 if cond is true
fn maybe_alloc(cond bool) MaybeAlloc {
    if cond {
        let i32(p) = alloc(@i32) .AllocFailed
        *p = 42
        return .Ok(p)
    }
    
    return .DidNotAlloc
}

fn main() {
    match maybe_alloc(false) {
        .Ok(p) { fmt_println_ptr(*p) }
        .DidNotAlloc { fmt_println("no allocation") }
    }
}
