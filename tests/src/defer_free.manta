// examples/defer_free.manta
mod main

use (
    "os"
)

// WriteAndCleanup is the return type for the write_and_cleanup function
type WriteAndCleanup enum {
    Ok
    OpenErr(os::Open)
    WriteErr(os::Write)
}

// write_and_cleanup writes the contents of the file at the given path to a temporary buffer
fn write_and_cleanup(path str) WriteAndCleanup {
    let .Ok(f) = os::open(path) wrap .OpenErr
    defer { os::close(f) }

    let []u8(buf) = alloc(@[]u8) !
    defer { free(buf) }

    let .Ok(n) = write(f, buf) wrap .WriteErr
    return .Ok
}
