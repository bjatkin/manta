[
  {
    "Function": {
      "name": "maybe_alloc",
      "params": [
        {
          "name": "cond",
          "type_spec": "Bool"
        }
      ],
      "return_type": {
        "Pointer": "Int32"
      },
      "body": {
        "statements": [
          {
            "If": {
              "check": {
                "Identifier": {
                  "name": "cond"
                }
              },
              "success": {
                "statements": [
                  {
                    "ShortLet": {
                      "name": {
                        "name": "p"
                      },
                      "value": {
                        "New": {
                          "type_spec": "Int32",
                          "len": null,
                          "cap": null
                        }
                      }
                    }
                  },
                  {
                    "Assign": {
                      "lvalue": {
                        "Unary": {
                          "operator": "Dereference",
                          "operand": {
                            "Identifier": {
                              "name": "p"
                            }
                          }
                        }
                      },
                      "rvalue": {
                        "IntLiteral": 42
                      }
                    }
                  },
                  {
                    "Return": {
                      "value": {
                        "Identifier": {
                          "name": "p"
                        }
                      }
                    }
                  }
                ]
              },
              "fail": null
            }
          },
          {
            "Return": {
              "value": "NilLiteral"
            }
          }
        ]
      }
    }
  },
  {
    "Function": {
      "name": "main",
      "params": [],
      "return_type": null,
      "body": {
        "statements": [
          {
            "ShortLet": {
              "name": {
                "name": "p"
              },
              "value": {
                "Call": {
                  "func": {
                    "Identifier": {
                      "name": "maybe_alloc"
                    }
                  },
                  "args": [
                    {
                      "BoolLiteral": false
                    }
                  ]
                }
              }
            }
          },
          {
            "If": {
              "check": {
                "Binary": {
                  "left": {
                    "Identifier": {
                      "name": "p"
                    }
                  },
                  "operator": "NotEqual",
                  "right": "NilLiteral"
                }
              },
              "success": {
                "statements": [
                  {
                    "Expr": {
                      "expr": {
                        "Call": {
                          "func": {
                            "Identifier": {
                              "name": "print"
                            }
                          },
                          "args": [
                            {
                              "Unary": {
                                "operator": "Dereference",
                                "operand": {
                                  "Identifier": {
                                    "name": "p"
                                  }
                                }
                              }
                            }
                          ]
                        }
                      }
                    }
                  },
                  {
                    "Expr": {
                      "expr": {
                        "Free": {
                          "expr": {
                            "Identifier": {
                              "name": "p"
                            }
                          }
                        }
                      }
                    }
                  }
                ]
              },
              "fail": {
                "statements": [
                  {
                    "Expr": {
                      "expr": {
                        "Call": {
                          "func": {
                            "Identifier": {
                              "name": "print"
                            }
                          },
                          "args": [
                            {
                              "StringLiteral": "no allocation"
                            }
                          ]
                        }
                      }
                    }
                  }
                ]
              }
            }
          }
        ]
      }
    }
  }
]