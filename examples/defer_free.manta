// examples/defer_free.manta
mod main

use (
    "os"
)

type ErrWrite enum {
    Ok
    WriteErr(os::OpenFile)
    OpenErr(os::WriteFile)
}

fn write_and_cleanup(path string) ErrWrite {
    let .Ok(f) = os::open_file(path) wrap .OpenErr
    defer { close(f) }

    let buf = new([]u8, 256)
    defer { free(buf) }

    let .Ok(n) = os::write_file(f, buf, 256) wrap .WriteErr
    return .Ok
}

fn main() {
    write_and_cleanup("test.md")
}
